<%- include ('header') -%>
<main>
    <%- include ('partials/messages') %>

    <section id="section1" class="position-relative section1 mb-5" style="margin-top: -44px">
        <div class="abs">
            <% if(pageData.length){ %>
                <h1><%= pageData[0].homeSliderText %></h1>
            <% } %>
        </div>
        <div class="owl-slider ">
            <div id="carousel1" class="owl-carousel owl-carousel1">
                <% if(pageData.length > 0){ %>
                    <% pageData[0].homeSliderImages.forEach(function(item){ %>
                        <div class="item">
                            <img src=<%= item %> alt="">
                        </div>
                    <% }) %>
                <% } %>
            </div>
        </div>
    </section>
    <section id="section2" class="section2 py-5">
        <div class="container pb-5 px-5">
            <h2 class="text-center mb-3 mb-md-5">
                <% if(pageData.length){ %>
                    <%= pageData[0].homeProductTypeTitle %>
                <% } %>
            </h2>
            <div class="owl-slider">
                <div id="carousel2" class="owl-carousel owl-carousel2">
                    <% if(products.length > 0){ %>
                        <% products.forEach(function(item){ %>
                            <div class="item">
                                <div class="card">
                                    <div class="img-area">
                                        <img class="card-img-top" src=<%= item.images[0] %> id='' alt="Card image cap">
                                    </div>
                                    <a href="#" class="btn btn-green-gradient"><%= item.name %></a>
                                </div>
                            </div>
                        <% }) %>
                    <% } %>
                </div>
            </div>
        </div>
    </section>
    <section id="section-brand-3" value=<%= pages %> class="section3">
        <div class="container-fluid">
            <div class="row justify-content-around  px-md-5" id="brands-render-place">

            </div>
            <div class="mb-5 d-flex justify-content-end px-md-5">
                <% if (pages > 0) { %>
                    <div class="pagination">
                        <a onclick="handelChosenPage(this)" id="-1" value="-1">&laquo;</a>
                        <% for (let i = 1;  i <= pages; i++) { %>
                            <% if (i == 1) { %>
                                <a class="active" id="<%= i %>" onclick="handelChosenPage(this)"
                                   value="<%= i %>">
                                    <%= i %>
                                </a>
                            <% }else{ %>
                                <a class="page-item" id="<%= i %>" onclick="handelChosenPage(this)"
                                   value="<%= i %>">
                                    <%= i %>
                                </a>
                            <% } %>
                        <% } %>
                        <a id="+1" onclick="handelChosenPage(this)" value="+1">&raquo;</a>
                    </div>
                <% } %>
            </div>
        </div>
    </section>
</main>

<%- include ('footer') -%>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="js/jquery.js"></script>
<script src="js/bootstrap/bootstrap.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".owl-carousel1").owlCarousel({
            autoplay: true,
            lazyLoad: true,
            loop: true,
            responsiveClass: true,
            autoHeight: true,
            autoplayTimeout: 7000,
            smartSpeed: 800,
            dots: true,
            nav: false,
            items: 1,
        });
        $(".owl-carousel2").owlCarousel({
            autoplay: true,
            lazyLoad: true,
            loop: true,
            responsiveClass: true,
            autoHeight: true,
            autoplayTimeout: 4000,
            smartSpeed: 800,
            nav: true,
            dots: false,
            items: 5,
            margin: 40,
            responsive: {
                0: {
                    items: 1
                },

                600: {
                    items: 2
                },

                1024: {
                    items: 3
                },
                1199: {
                    items: 5
                },

                1366: {
                    items: 5
                }
            },

        });
    });
</script>
<script type="text/javascript">
    window.onload = function () {
        $.ajax({
            url: '/brands',
            method: 'get',
            data: {
                page: 1,
            },
            success: function (result) {
                $("#brands-render-place").empty();
                result.results.brands.map((item) => {
                    let brandsRenderPlace = document.getElementById('brands-render-place');
                    let div = document.createElement('div');
                    div.setAttribute('class', 'col-6 col-md-4 col-lg-3 overflow-hidden');
                    div.innerHTML = `  <a href="/shop" class="home-card-pagination">
                           <img src=${item.images[1]} alt="pic"/>
                           <div class="home-card-pagination-title">${item.name}</div>
                       </a>`;
                    brandsRenderPlace.appendChild(div);
                });
            },
            error: function (data) {
                console.log('User creation failed :' + data);
            }
        });
    };

    function handelChosenPage(item) {
        let pagesCount = document.getElementById('section-brand-3').getAttribute('value');
        const elementValue = item.getAttribute('value');
        const elementAttributes = item.getAttribute('class');
        let pageNumber;
        console.log('elementValue', elementValue);
        if (elementValue === '-1') {
            for (let i = 1; i <= Number(pagesCount); i++) {
                if (document.getElementById(`${i}`).getAttribute('class').includes('active')) {
                    if (i === 1) {
                        pageNumber = i;
                        document.getElementById(`${i}`).setAttribute("class", "page-item active");
                        document.getElementById(`${elementValue}`).setAttribute("class", "page-item disabled");
                        break;
                    } else {
                        pageNumber = i - 1;
                        document.getElementById(`${i - 1}`).setAttribute("class", "page-item active");
                        document.getElementById(`${i}`).setAttribute("class", "page-item disabled");
                        break;
                    }
                }
            }
        } else if (elementValue === '+1') {
            for (let i = 1; i <= Number(pagesCount); i++) {
                if (document.getElementById(`${i}`).getAttribute('class').includes('active')) {
                    if (i === Number(pagesCount)) {
                        pageNumber = i;
                        document.getElementById(`${i}`).setAttribute("class", "page-item active");
                        document.getElementById(`${elementValue}`).setAttribute("class", "page-item disabled");
                        break;
                    } else {
                        pageNumber = i + 1;
                        document.getElementById(`${i}`).setAttribute("class", "page-item disabled");
                        document.getElementById(`${i + 1}`).setAttribute("class", "page-item active");
                        break;
                    }
                }
            }
        } else {
            if (elementAttributes.includes('active')) {
                for (let i = 1; i <= Number(pagesCount); i++) {
                    if (i === Number(elementValue)) {
                        document.getElementById(`${elementValue}`).setAttribute("class", "page-item active");
                    } else {
                        document.getElementById(`${i}`).setAttribute("class", "page-item disabled");
                    }
                }
            } else {
                for (let i = 1; i <= Number(pagesCount); i++) {
                    if (i === Number(elementValue)) {
                        document.getElementById(`${elementValue}`).setAttribute("class", "page-item active");
                    } else {
                        document.getElementById(`${i}`).setAttribute("class", "page-item disabled");
                    }
                }
            }
        }
        if (pageNumber === undefined) {
            pageNumber = Number(elementValue);
        }
        $.ajax({
            url: '/brands',
            method: 'get',
            data: {
                page: pageNumber,
            },
            success: function (result) {
                $("#brands-render-place").empty();
                result.results.brands.map((item) => {
                    let brandsRenderPlace = document.getElementById('brands-render-place');
                    let div = document.createElement('div');
                    div.setAttribute('class', 'col-6 col-md-4 col-lg-3 overflow-hidden');
                    div.innerHTML = `  <a href="/shop" class="home-card-pagination">
                           <img src=${item.images[1]} alt="pic"/>
                           <div class="home-card-pagination-title">${item.name}</div>
                       </a>`;
                    brandsRenderPlace.appendChild(div);
                });
            },
            error: function (data) {
                console.log('User creation failed :' + data);
            }
        });
    }
</script>
<script src="js/script.js"></script>

</body>
</html>